<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kreon Rechner v3</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; background-color: #f0f2f5; color: #1c1e21; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h2 { text-align: center; margin-bottom: 20px; color: #050505; }
        
        label { display: block; margin-top: 15px; font-weight: 600; font-size: 14px; color: #65676b; }
        
        /* Container f√ºr Input + Reset Button */
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="number"] { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ced0d4; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        
        /* Der kleine Reset-Button im Feld */
        .clear-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-30%); background: #e4e6eb; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; color: #65676b; font-weight: bold; display: flex; align-items: center; justify-content: center; }

        /* Schnell-Buttons */
        .quick-buttons { display: flex; gap: 10px; margin-top: 10px; }
        .q-btn { flex: 1; padding: 10px; background-color: #e7f3ff; color: #0084ff; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .q-btn:hover { background-color: #dbe7f2; }

        /* Design f√ºr die Checkboxen */
        .checkbox-group { background: #f7f8fa; padding: 10px; border-radius: 8px; margin-top: 10px; }
        .checkbox-item { display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; }
        .checkbox-item input { margin-right: 10px; transform: scale(1.3); cursor: pointer; }
        
        button.main-btn { width: 100%; padding: 15px; background-color: #0084ff; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; margin-top: 25px; cursor: pointer; transition: background 0.2s; }
        button.main-btn:hover { background-color: #0073e6; }
        
        .result { margin-top: 25px; padding: 20px; background-color: #e7f3ff; border: 1px solid #dbe7f2; border-radius: 8px; text-align: center; display: none; }
        .result-main { font-size: 24px; font-weight: bold; color: #0084ff; margin-bottom: 10px; }
        .result-details { font-size: 14px; color: #606770; line-height: 1.5; }
        .error { color: #d93025; font-weight: bold; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>üíä Kreon Rechner</h2>

    <label for="fatInput">Fettgehalt (g):</label>
    <div class="input-wrapper">
        <input type="number" id="fatInput" inputmode="numeric" placeholder="0">
        <button class="clear-btn" onclick="resetFett()">x</button>
    </div>
    
    <div class="quick-buttons">
        <button class="q-btn" onclick="addFett(1)">+1</button>
        <button class="q-btn" onclick="addFett(5)">+5</button>
        <button class="q-btn" onclick="addFett(10)">+10</button>
    </div>

    <label for="factorInput">Faktor (Lipase pro g Fett):</label>
    <input type="number" id="factorInput" inputmode="numeric" placeholder="z.B. 2000" onchange="speichereDaten()">

    <label>Verf√ºgbare Kapseln:</label>
    <div class="checkbox-group">
        <label class="checkbox-item">
            <input type="checkbox" id="check35" onchange="speichereDaten()" checked> 35.000 Einheiten
        </label>
        <label class="checkbox-item">
            <input type="checkbox" id="check25" onchange="speichereDaten()" checked> 25.000 Einheiten
        </label>
        <label class="checkbox-item">
            <input type="checkbox" id="check10" onchange="speichereDaten()" checked> 10.000 Einheiten
        </label>
    </div>

    <div id="errorMsg" class="error">Bitte mindestens eine Kapselart w√§hlen!</div>

    <button class="main-btn" onclick="berechneUndEmpfehle()">Berechnen</button>

    <div id="ergebnisBox" class="result">
        <div id="kapselVorschlag" class="result-main"></div>
        <div id="detailInfo" class="result-details"></div>
    </div>
</div>

<script>
    // BEIM STARTEN: Alle gespeicherten Daten laden
    window.onload = function() {
        // Faktor laden
        let gespeicherterFaktor = localStorage.getItem('kreon_faktor');
        if (gespeicherterFaktor) {
            document.getElementById('factorInput').value = gespeicherterFaktor;
        }

        // Checkboxen laden (wir m√ºssen pr√ºfen ob "true" oder "false" gespeichert wurde)
        loadCheckbox('check35', 'kreon_check35');
        loadCheckbox('check25', 'kreon_check25');
        loadCheckbox('check10', 'kreon_check10');
    };

    // Hilfsfunktion zum Laden der Checkboxen
    function loadCheckbox(elementId, storageKey) {
        let saved = localStorage.getItem(storageKey);
        // Nur wenn ein Wert gespeichert ist, wenden wir ihn an. Sonst bleibt der Standard (checked).
        if (saved !== null) {
            document.getElementById(elementId).checked = (saved === 'true');
        }
    }

    // Funktion zum Speichern ALLER Einstellungen
    function speichereDaten() {
        // Faktor speichern
        let faktorWert = document.getElementById('factorInput').value;
        localStorage.setItem('kreon_faktor', faktorWert);

        // Checkboxen speichern
        localStorage.setItem('kreon_check35', document.getElementById('check35').checked);
        localStorage.setItem('kreon_check25', document.getElementById('check25').checked);
        localStorage.setItem('kreon_check10', document.getElementById('check10').checked);
    }

    // Hilfsfunktionen f√ºr die Buttons
    function addFett(menge) {
        let feld = document.getElementById('fatInput');
        let aktuellerWert = parseFloat(feld.value);
        if (isNaN(aktuellerWert)) aktuellerWert = 0;
        
        feld.value = aktuellerWert + menge;
        // Optional: Sofort neu berechnen, wenn man klickt? 
        // Ich lasse es erstmal weg, damit man in Ruhe klicken kann und dann "Berechnen" dr√ºckt.
    }

    function resetFett() {
        document.getElementById('fatInput').value = '';
        document.getElementById('ergebnisBox').style.display = 'none';
    }

    function berechneUndEmpfehle() {
        document.getElementById('errorMsg').style.display = 'none';
        document.getElementById('ergebnisBox').style.display = 'none';

        let fett = parseFloat(document.getElementById('fatInput').value);
        let faktor = parseFloat(document.getElementById('factorInput').value);

        // Auch beim Klick sicherheitshalber speichern
        speichereDaten();

        if (!fett || !faktor) {
            // Nur meckern, wenn wirklich nichts drin steht
            if(!fett && !faktor) alert("Bitte Werte eingeben");
            return;
        }

        // 1. Welche Kapseln sind angehakt?
        let kapseln = [];
        if(document.getElementById('check35').checked) kapseln.push(35000);
        if(document.getElementById('check25').checked) kapseln.push(25000);
        if(document.getElementById('check10').checked) kapseln.push(10000);

        if (kapseln.length === 0) {
            document.getElementById('errorMsg').style.display = 'block';
            return;
        }

        // 2. Bedarf berechnen
        let bedarf = fett * faktor;
        let restBedarf = bedarf;
        let vorschlag = [];

        // 3. Logik: Kapseln durchgehen
        for (let i = 0; i < kapseln.length; i++) {
            let kapselGr√∂√üe = kapseln[i];
            let anzahl = Math.floor(restBedarf / kapselGr√∂√üe);
            
            if (anzahl > 0) {
                vorschlag.push(anzahl + "x " + (kapselGr√∂√üe/1000) + ".000er");
                restBedarf = restBedarf - (anzahl * kapselGr√∂√üe);
            }
        }

        // 4. Rest-Handling
        if (restBedarf > 0) {
            let kleinsteVerf√ºgbare = kapseln[kapseln.length - 1];
            vorschlag.push("1x " + (kleinsteVerf√ºgbare/1000) + ".000er (Zuschlag)");
        }

        // Anzeige
        document.getElementById('ergebnisBox').style.display = 'block';
        
        if (bedarf <= 0) {
             document.getElementById('kapselVorschlag').innerText = "Kein Bedarf";
        } else {
             document.getElementById('kapselVorschlag').innerText = vorschlag.join(" + ");
             document.getElementById('detailInfo').innerHTML = 
                "Exakter Bedarf: " + bedarf.toLocaleString() + " Einheiten.";
        }
    }
</script>

</body>
</html>
